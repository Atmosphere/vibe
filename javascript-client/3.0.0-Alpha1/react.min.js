/* React v3.0.0-Alpha1 | http://atmosphere.github.io/react/ | (c) 2011-2014, Donghwan Kim | http://www.apache.org/licenses/LICENSE-2.0 */
(function(k,u){if("function"===typeof define&&define.amd)define([],function(){return u(k)});else if("object"===typeof exports){var x=require("jsdom").jsdom().createWindow();x.WebSocket=require("ws");x.EventSource=require("eventsource");module.exports=u(x);module.exports.util.corsable=!0}else k.react=u(k)})(this,function(k){function u(c){var b,a,f,h,d,g,e=[],k=function(k,m){m=m||[];a=!c||[k,m];f=!0;g=h||0;h=0;for(d=e.length;g<d&&!b;g++)e[g].apply(k,m);f=!1};return{add:function(c){var m=e.length;e.push(c);
f?d=e.length:!b&&a&&!0!==a&&(h=m,k(a[0],a[1]))},remove:function(a){var b;for(b=0;b<e.length;b++)if(a===e[b]||a.guid&&a.guid===e[b].guid)f&&b<=d&&(d--,b<=g&&g--),e.splice(b--,1)},fire:function(d,h){b||f||c&&a||k(d,h)},lock:function(){b=!0},locked:function(){return!!b},unlock:function(){b=a=f=h=d=g=void 0}}}function x(c,b){c=e.makeAbsolute(c);var a,f=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(c.toLowerCase()),h={transports:["ws","stream","longpoll"],timeout:!1,heartbeat:!1,_heartbeat:5E3,
sharing:!1,reconnect:function(a){return 2*(a||250)},xdrURL:null};if(b)for(a in b)h[a]=b[a];b=h;b.url=c;b.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var d=16*Math.random()|0;return("x"===a?d:d&3|8).toString(16)});b.crossOrigin=!(!f||f[1]==z.protocol&&f[2]==z.hostname&&(f[3]||("http:"===f[1]?80:443))==(z.port||("http:"===z.protocol?80:443)));var d={},g={};d.on=function(a,d){var b;b=g[a];if(!b){if(g.message.locked())return this;b=g[a]=u();b.order=g.message.order}b.add(d);return this};
d.off=function(a,d){var b=g[a];b&&b.remove(d);return this};d.once=function(a,b){function c(){d.off(a,c);b.apply(d,arguments)}b.guid=b.guid||w++;c.guid=b.guid;return d.on(a,c)};d.fire=function(a){var b=g[a];b&&b.fire(d,E.call(arguments,1));return this};var r;d.state=function(){return r};for(a in{connecting:1,open:1,close:1,waiting:1})g[a]=u(!0),g[a].order=w++;g.message=u(!1);g.message.order=g.open.order;d.on("connecting",function(){function a(){clearTimeout(f)}function h(){function a(b){b=e.parseJSON(b);
if("p"===b.target)switch(b.type){case "send":b=e.parseJSON(b.data);d.send(b.type,b.data,b.onResolved,b.onRejected);break;case "close":d.close()}}function f(a){m.broadcast({target:"c",type:"message",data:a})}function g(){n.cookie=encodeURIComponent(s)+"="+encodeURIComponent(e.stringifyJSON({ts:e.now(),heir:(m.get("children")||[])[0]}))+"; path=/"}var l,m,s="socket-"+c,t={storage:function(){var b=k.localStorage;if(!e.browser.msie)return{init:function(){function c(b){b.key===s&&b.newValue&&a(b.newValue)}
e.on(k,"storage",c);d.once("close",function(){e.off(k,"storage",c);d.once("close",function(){b.removeItem(s);b.removeItem(s+"-opened");b.removeItem(s+"-children")})})},broadcast:function(d){var c=e.stringifyJSON(d);b.setItem(s,c);setTimeout(function(){a(c)},50)},get:function(a){return e.parseJSON(b.getItem(s+"-"+a))},set:function(a,d){b.setItem(s+"-"+a,e.stringifyJSON(d))}}},windowref:function(){var b=s.replace(/\W/g,""),d=n.getElementById(b),c;d||(d=n.createElement("div"),d.id=b,d.style.display=
"none",d.innerHTML='<iframe name="'+b+'" />',n.body.appendChild(d));c=d.firstChild.contentWindow;return{init:function(){c.callbacks=[a];c.fire=function(b){var a;for(a=0;a<c.callbacks.length;a++)c.callbacks[a](b)}},broadcast:function(b){!c.closed&&c.fire&&c.fire(e.stringifyJSON(b))},get:function(b){return c.closed?null:c[b]},set:function(b,a){c.closed||(c[b]=a)}}}};m=t.storage()||t.windowref();m.init();m.set("children",[]);m.set("opened",!1);g();l=setInterval(g,1E3);d.on("_message",f).once("open",
function(){m.set("opened",!0);m.broadcast({target:"c",type:"open"})}).once("close",function(a){clearInterval(l);n.cookie=encodeURIComponent(s)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";m.broadcast({target:"c",type:"close",data:{reason:a,heir:A?(m.get("children")||[])[0]:b.id}});d.off("_message",f)})}r="connecting";var f;0<b.timeout&&(f=setTimeout(function(){d.fire("close","timeout");p.close()},b.timeout),d.once("open",a).once("close",a));b.sharing&&!y&&h()}).on("open",function(){function a(){c=
setTimeout(function(){d.send("heartbeat").once("heartbeat",function(){clearTimeout(c);a()});c=setTimeout(function(){d.fire("close","error");p.close()},b._heartbeat)},b.heartbeat-b._heartbeat)}r="opened";var c;b.heartbeat>b._heartbeat&&(a(),d.once("close",function(){clearTimeout(c)}));g.connecting.lock();m=t=l=null}).on("close",function(){r="closed";var a,c,h=g.close.order;for(a in g)c=g[a],c.order<h&&c.lock();if(b.reconnect)d.once("close",function(){l=l||1;t=b.reconnect.call(d,t,l);!1!==t&&(m=setTimeout(function(){d.open()},
t),d.fire("waiting",t,l))})}).on("waiting",function(){r="waiting"});var p,y,m,t,l;d.open=function(){var a,c;clearTimeout(m);for(a in g)g[a].unlock();p=y=null;r="preparing";c=E.call(b.transports);for(b.sharing&&c.unshift("session");!p&&c.length;)switch(a=c.shift(),a){case "stream":c.unshift("sse","streamxhr","streamxdr","streamiframe");break;case "longpoll":c.unshift("longpollajax","longpollxdr","longpolljsonp");break;default:p=q[a](d,b)}l&&l++;p?(b.transport=a,y="session"===a,d.fire("connecting"),
p.open()):d.fire("close","notransport");return this};d.close=function(){b.reconnect=!1;clearTimeout(m);d.fire("close",A?"error":"aborted");p&&p.close();return this};var C={};d.send=function(a,b,c,d){if("opened"!==r)throw Error("A socket is not open yet");a={id:w++,type:a,data:b,reply:!(!c&&!d)};a.reply&&(y?(a.onResolved=c,a.onRejected=d):C[a.id]=[c,d]);p.send(e.stringifyJSON(a));return this};d.receive=function(a){var b,c=e.parseJSON(a);a=[c.type,c.data,c.reply?{resolve:function(a){b||(b=!0,d.send("reply",
{id:c.id,data:a,exception:!1}))},reject:function(a){b||(b=!0,d.send("reply",{id:c.id,data:a,exception:!0}))}}:null];return d.fire.apply(d,a).fire("_message",a)};d.on("reply",function(a){var b=a.id,c=a.data,h=C[b];h&&((a=h[+a.exception])&&(e.isFunction(a)?a.call(d,c):d.fire(a,c).fire("_message",[a,c])),delete C[b])});return d.open()}var w=1,A,E=Array.prototype.slice,D=Object.prototype.toString,G=Object.prototype.hasOwnProperty,n=k.document,z=k.location,H=k.navigator,e;e={now:Date.now||function(){return+new Date},
isArray:Array.isArray||function(c){return"[object Array]"===D.call(c)},isFunction:function(c){return"[object Function]"===D.call(c)},makeAbsolute:function(c){var b=n.createElement("div");b.innerHTML='<a href="'+c+'"/>';return encodeURI(decodeURI(b.firstChild.href))},on:function(c,b,a){c.addEventListener?c.addEventListener(b,a,!1):c.attachEvent&&c.attachEvent("on"+b,a)},off:function(c,b,a){c.removeEventListener?c.removeEventListener(b,a,!1):c.detachEvent&&c.detachEvent("on"+b,a)},url:function(c,b){var a,
f=[];b=b||{};b._=w++;for(a in b)f.push(encodeURIComponent(a)+"="+encodeURIComponent(b[a]));return c+(/\?/.test(c)?"&":"?")+f.join("&").replace(/%20/g,"+")},xhr:function(){try{return new k.XMLHttpRequest}catch(c){try{return new k.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}},parseJSON:k.JSON?k.JSON.parse:function(c){return Function("return "+c)()},stringifyJSON:k.JSON?k.JSON.stringify:function(c){function b(a){return'"'+a.replace(f,function(a){var b=h[a];return"string"===typeof b?b:"\\u"+("0000"+
a.charCodeAt(0).toString(16)).slice(-4)})+'"'}function a(a){return 10>a?"0"+a:a}var f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function g(c,h){var f,m,e,l=h[c];e=typeof l;l&&"object"===typeof l&&"function"===typeof l.toJSON&&(l=l.toJSON(c),e=typeof l);switch(e){case "string":return b(l);case "number":return isFinite(l)?String(l):
"null";case "boolean":return String(l);case "object":if(!l)return"null";switch(D.call(l)){case "[object Date]":return isFinite(l.valueOf())?'"'+l.getUTCFullYear()+"-"+a(l.getUTCMonth()+1)+"-"+a(l.getUTCDate())+"T"+a(l.getUTCHours())+":"+a(l.getUTCMinutes())+":"+a(l.getUTCSeconds())+'Z"':"null";case "[object Array]":m=l.length;e=[];for(f=0;f<m;f++)e.push(g(f,l)||"null");return"["+e.join(",")+"]";default:e=[];for(f in l)G.call(l,f)&&(m=g(f,l))&&e.push(b(f)+":"+m);return"{"+e.join(",")+"}"}}}("",{"":c})}};
e.corsable="withCredentials"in e.xhr();e.browser=function(){var c=H.userAgent.toLowerCase(),b={},c=/(msie) ([\w.]+)/.exec(c)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(c)||[];b[c[1]||""]=!0;b.version=c[2]||"0";b.trident&&(b.msie=!0);return b}();var q,F=[];q={session:function(c,b){function a(a,b){var c,d=a.length;for(c=0;c<d;c++)a[c]===b&&a.splice(c,1);return d!==a.length}function f(a){a=e.parseJSON(a);var d=a.data;if("c"===a.target)switch(a.type){case "open":c.fire("open");break;case "close":g||(g=!0,
"aborted"===d.reason?c.close():d.heir===b.id?c.fire("close",d.reason):setTimeout(function(){c.fire("close",d.reason)},100));break;case "message":if("connecting"===c.state())c.once("open",function(){c.fire.apply(c,d)});else c.fire.apply(c,d)}}function h(){var a=RegExp("(?:^|; )("+encodeURIComponent(p)+")=([^;]*)").exec(n.cookie);if(a)return e.parseJSON(decodeURIComponent(a[2]))}var d,g,r,p="socket-"+b.url,q={storage:function(){function d(a){return e.parseJSON(g.getItem(p+"-"+a))}function h(a,b){g.setItem(p+
"-"+a,e.stringifyJSON(b))}if(!e.browser.msie){var g=k.localStorage;return{init:function(){function g(a){a.key===p&&a.newValue&&f(a.newValue)}h("children",d("children").concat([b.id]));e.on(k,"storage",g);c.once("close",function(){var c=d("children");e.off(k,"storage",g);c&&a(c,b.id)&&h("children",c)});return d("opened")},broadcast:function(a){var b=e.stringifyJSON(a);g.setItem(p,b);setTimeout(function(){f(b)},50)}}}},windowref:function(){var d=k.open("",p.replace(/\W/g,""));if(d&&!d.closed&&d.callbacks)return{init:function(){d.callbacks.push(f);
d.children.push(b.id);c.once("close",function(){g||(a(d.callbacks,f),a(d.children,b.id))});return d.opened},broadcast:function(a){!d.closed&&d.fire&&d.fire(e.stringifyJSON(a))}}}};if((d=h())&&!(1E3<e.now()-d.ts)&&(r=q.storage()||q.windowref()))return{open:function(){var a,g=b.timeout,l=b.heartbeat;b.timeout=b.heartbeat=!1;a=setInterval(function(){var a=d;(d=h())&&a.ts!==d.ts||f(e.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:a.heir}}))},1E3);c.once("close",function(){clearInterval(a);
b.timeout=g;b.heartbeat=l});r.init()&&setTimeout(function(){c.fire("open")},50)},send:function(a){r.broadcast({target:"p",type:"send",data:a})},close:function(){A||r.broadcast({target:"p",type:"close"})}}},base:function(c,b){return{uri:{open:function(){return e.url(b.url,{id:b.id,when:"open",transport:b.transport,heartbeat:b.heartbeat})}}}},ws:function(c,b){var a,f=k.WebSocket,h=q.base(c,b);if(f)return h.open=function(){var b=h.uri.open().replace(/^http/,"ws");a=new f(b);a.onopen=function(){c.fire("open")};
a.onmessage=function(a){c.receive(a.data)};a.onerror=function(){c.fire("close","error")};a.onclose=function(a){c.fire("close",a.wasClean?"done":"error")}},h.send=function(b){a.send(b)},h.close=function(){a.close()},h},httpbase:function(c,b){var a=e.url(b.url,{id:b.id}),f=q.base(c,b);f.send=!b.crossOrigin||e.corsable?function(b){var c=e.xhr();c.open("POST",a);c.setRequestHeader("content-type","text/plain; charset=UTF-8");e.corsable&&(c.withCredentials=!0);c.send("data="+b)}:k.XDomainRequest&&b.xdrURL?
function(h){var d=new k.XDomainRequest;d.open("POST",b.xdrURL.call(c,a));d.send("data="+h)}:function(b){var c=n.createElement("form");c.action=a;c.target="socket-"+w++;c.method="POST";c.enctype=c.encoding="text/plain";c.acceptCharset="UTF-8";c.style.display="none";c.innerHTML='<textarea name="data"></textarea><iframe name="'+c.target+'"></iframe>';c.firstChild.value=b;e.on(c.lastChild,"load",function(){n.body.removeChild(c)});n.body.appendChild(c);c.submit()};f.close=function(){f.abort();var a=n.createElement("script"),
c=n.head||n.getElementsByTagName("head")[0]||n.documentElement;a.async=!1;a.src=e.url(b.url,{id:b.id,when:"abort"});a.onload=a.onreadystatechange=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a)};c.insertBefore(a,c.firstChild)};return f},sse:function(c,b){var a,f=k.EventSource,h=q.httpbase(c,b);if(f)return h.open=function(){var b=h.uri.open();a=new f(b,{withCredentials:!0});a.onopen=function(){c.fire("open")};
a.onmessage=function(a){c.receive(a.data)};a.onerror=function(){a.close();c.fire("close","done")}},h.abort=function(){a.close()},h},streambase:function(c,b){var a="",f=q.httpbase(c,b);f.parse=function(b){if(b=b.replace(/^\s+/,"")){var d=(a+b).split("\n\n");for(b=0;b<d.length-1;b++)c.receive(d[b].substring(6));a=d[d.length-1]}};return f},streamxhr:function(c,b){var a,f=q.streambase(c,b);if(!(e.browser.msie&&10>+e.browser.version.split(".")[0]||b.crossOrigin&&!e.corsable))return f.open=function(){var b,
d,g=f.uri.open();a=e.xhr();a.onreadystatechange=function(){3===a.readyState&&200===a.status?(d=a.responseText.length,b?d>b&&f.parse(a.responseText.substring(b)):(c.fire("open"),f.parse(a.responseText)),b=d):4===a.readyState&&c.fire("close",200===a.status?"done":"error")};a.open("GET",g);e.corsable&&(a.withCredentials=!0);a.send(null)},f.abort=function(){a.abort()},f},streamxdr:function(c,b){var a,f=k.XDomainRequest,e=q.streambase(c,b);if(f&&b.xdrURL)return e.open=function(){var d,g,k=b.xdrURL.call(c,
e.uri.open());a=new f;a.onprogress=function(){g=a.responseText.length;d?e.parse(a.responseText.substring(d)):(c.fire("open"),e.parse(a.responseText));d=g};a.onerror=function(){c.fire("close","error")};a.onload=function(){c.fire("close","done")};a.open("GET",k);a.send()},e.abort=function(){a.abort()},e},streamiframe:function(c,b){var a,f,e=k.ActiveXObject,d=q.streambase(c,b);if(e&&!b.crossOrigin){try{new e("htmlfile")}catch(g){return}d.open=function(){function b(a){var c;(function s(){c=setTimeout(function(){!1!==
a()&&s()},1)})();return function(){clearTimeout(c)}}var g,k,m=d.uri.open();a=new e("htmlfile");a.open();a.close();g=a.createElement("iframe");g.src=m;a.body.appendChild(g);k=g.contentDocument||g.contentWindow.document;f=b(function(){function a(){var b;b=e.cloneNode(!0);b.appendChild(k.createTextNode("."));b=b.innerText.replace(/\r\n/g,"\n");return b.substring(0,b.length-1)}var e;if(k.firstChild){e=k.body.lastChild;if(!e)return c.fire("close","error"),!1;c.fire("open");d.parse(a());e.innerText="";
f=b(function(){var b=a();b&&(e.innerText="",d.parse(b));if("complete"===k.readyState)return c.fire("close","done"),!1});return!1}})};d.abort=function(){f();a.execCommand("Stop")};return d}},longpollbase:function(c,b){var a=q.httpbase(c,b);a.uri.poll=function(a){return e.url(b.url,{id:b.id,when:"poll",lastEventIds:a.join(",")})};a.open=function(){a.connect(a.uri.open(),function(){function b(h){a.connect(a.uri.poll(h),function(a){if(a){var g=[];a=e.parseJSON(a);var h=e.isArray(a)?a:[a];for(a=0;a<h.length;a++)g.push(h[a].id);
b(g);for(a=0;a<h.length;a++)c.receive(e.stringifyJSON(h[a]))}else c.fire("close","done")})}b([]);c.fire("open")})};return a},longpollajax:function(c,b){var a,f=q.longpollbase(c,b);if(!b.crossOrigin||e.corsable)return f.connect=function(b,d){a=e.xhr();a.onreadystatechange=function(){4===a.readyState&&(200===a.status?d(a.responseText):c.fire("close","error"))};a.open("GET",b);e.corsable&&(a.withCredentials=!0);a.send(null)},f.abort=function(){a.abort()},f},longpollxdr:function(c,b){var a,e=k.XDomainRequest,
h=q.longpollbase(c,b);if(e&&b.xdrURL)return h.connect=function(d,g){d=b.xdrURL.call(c,d);a=new e;a.onload=function(){g(a.responseText)};a.onerror=function(){c.fire("close","error")};a.open("GET",d);a.send()},h.abort=function(){a.abort()},h},longpolljsonp:function(c,b){var a,e=F.pop()||"socket_"+w++,h=q.longpollbase(c,b);k[e]=function(b){a.responseText=b};c.once("close",function(){k[e]=function(){};F.push(e)});h.uri._open=h.uri.open;h.uri.open=function(){return h.uri._open.apply(h,arguments)+"&callback="+
e};h.connect=function(b,e){var f=n.head||n.getElementsByTagName("head")[0]||n.documentElement;a=n.createElement("script");a.async=!0;a.src=b;a.clean=function(){a.clean=a.src=a.onerror=a.onload=a.onreadystatechange=null;a.parentNode&&a.parentNode.removeChild(a)};a.onload=a.onreadystatechange=function(){if(!a.readyState||/loaded|complete/.test(a.readyState))a.clean&&a.clean(),e(a.responseText)};a.onerror=function(){a.clean();c.fire("close","error")};f.insertBefore(a,f.firstChild)};h.abort=function(){a.clean&&
a.clean()};return h}};var B={},v=[];B.open=function(c,b){var a=x(c,b);v.push(a);return a};B.util=e;B.transports=q;e.on(k,"unload",function(){A=!0;var c,b;for(c=0;c<v.length;c++)b=v[c],"closed"!==b.state()&&b.close()});e.on(k,"online",function(){var c,b;for(c=0;c<v.length;c++)b=v[c],"waiting"===b.state()&&b.open()});e.on(k,"offline",function(){var c,b;for(c=0;c<v.length;c++)b=v[c],"opened"===b.state()&&b.fire("close","error")});return B});